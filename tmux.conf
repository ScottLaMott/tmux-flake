# vim: foldmarker=[[[,]]] foldmethod=marker

# This config is mostly based on these articles:
# https://ianthehenry.com/posts/how-to-configure-tmux/
# https://ianthehenry.com/posts/tmux-psa/

# Global stuff [[[
set -g history-limit 50000

# Clear shortcuts
unbind -a -T prefix
unbind -a -T root
unbind -a -T copy-mode
unbind -a -T copy-mode-vi

# Set prefix to ctrl+F, to press with one hand
set-option -g prefix C-f
# ]]]

# Copy mode bindings [[[
bind -N "Enter copy mode" Space copy-mode
bind -N "Exit copy mode" -T copy-mode-vi Escape send -X cancel
bind -N "Exit copy mode" -T copy-mode-vi C-c send -X cancel
bind -N "Enter copy mode and begin selection" v copy-mode\; send -X begin-selection
bind -N "Begin selection" -T copy-mode-vi v send -X begin-selection
# Binding to enter the copy mode and jump halfpage up
bind -N "Enter copy and jump up" C-u copy-mode\; send -X halfpage-up

# Copy
bind -N "Y(ank) = Copy" -T copy-mode-vi y send -X copy-pipe 'wl-copy'
bind -N "Enter = Copy" -T copy-mode-vi Enter send -X copy-pipe-and-cancel 'wl-copy'
bind -N "Space = clear selection if present" -T copy-mode-vi Space if -F "#{selection_present}" { send -X clear-selection }
# Paste
bind -N "(p)aste" p paste-buffer -p

# Navigation [[[
# Base cursor navigation
bind -N "Vim-like move cursor left" -T copy-mode-vi h send -X cursor-left
bind -N "Vim-like move cursor down" -T copy-mode-vi j send -X cursor-down
bind -N "Vim-like move cursor up" -T copy-mode-vi k send -X cursor-up
bind -N "Vim-like move cursor right" -T copy-mode-vi l send -X cursor-right
# Word jumping
# Make it vim-like, from default config
bind -T copy-mode-vi w send -X next-word
bind -T copy-mode-vi W send -X next-space
bind -T copy-mode-vi e send -X next-word-end
bind -T copy-mode-vi E send -X next-space-end
bind -T copy-mode-vi b send -X previous-word
bind -T copy-mode-vi B send -X previous-space
# General jumping
bind -N "Vim-like: Go to beginning of the line" -T copy-mode-vi 0 send -X start-of-line
bind -N "Vim-like: Go to end of the line" -T copy-mode-vi $ send -X start-of-line
bind -N "(g)o to the beginning of the session" -T copy-mode-vi g send -X history-top
bind -N "(G)o to the end of the session" -T copy-mode-vi G send -X history-bottom
bind -N "with ctrl: Go halfpage-(u)p" -T copy-mode-vi C-u send -X halfpage-up
bind -N "with ctrl: Go halfpage-(d)own" -T copy-mode-vi C-d send -X halfpage-down
# ]]]

# Search
bind -N "Search forward" -T copy-mode-vi / command-prompt -i -p "(search down)" { send -X search-forward-incremental  "%%%" }
bind -N "Search back" -T copy-mode-vi ? command-prompt -i -p "(search up)"   { send -X search-backward-incremental "%%%" }
bind -N "Search back" -T copy-mode-vi n send -X search-again
bind -N "Search back" -T copy-mode-vi N send -X search-reverse
# Select
bind -N "Vim-like: select whole line" -T copy-mode-vi V send -X select-line

# ]]]

# Layout [[[
# Splits:
## Create
bind -N "Split: create horizontal. Usable without prefix."   -T root M-b split-window -h -c "#{pane_current_path}"
bind -N "Split: create vertical. Usable without prefix."     -T root M-v split-window -v -c "#{pane_current_path}"
## Navigate
bind -N "Select left pane" -r h select-pane -L
bind -N "Select lower pane" -r j select-pane -D
bind -N "Select upper pane" -r k select-pane -U
bind -N "Select right pane" -r l select-pane -R
## Fix layouts
bind -N "Even out the layout vertically"    = select-layout even-vertical
bind -N "Even out the layout horizontally"  + select-layout tiled

## Pane resizing
bind -N "Grow the pane to the left" -r H resize-pane -L 10
bind -N "Grow the pane down" -r J resize-pane -D 10
bind -N "Grow the pane up" -r K resize-pane -U 10
bind -N "Grow the pane to the right" -r L resize-pane -R 10

# Windows:
bind -N "Create new window" c     new-window -a -t '{end}'
bind -N "Next window" n next-window
bind -N "Go to last window" ` last-window
bind -N "Go to last window (double-tap prefix)" C-f last-window
bind -N "Kill window" x confirm-before -p "kill-window #W? (y/n)" kill-window
bind -N "Full screen toggle" z resize-pane -Z
# Jump to window by number
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9
bind 0 select-window -t 0
#]]]

# Misc [[[
bind d detach-client
bind : command-prompt
bind Enter command-prompt
bind r source-file -F "/etc/tmux.conf" \; display "Reloaded"
bind -N "F1 to list keys" F1 list-keys -N \; list-keys
# ]]]

# UI [[[
# Display the current process on the top of the pane
set -g pane-border-status top
set -g pane-border-format "#{pane_index} #{pane_current_command}"
# ]]]
